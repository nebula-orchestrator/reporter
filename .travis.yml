language: python
dist: xenial
python:
- '3.7'
env:
  global:
  - MONGO_URL=mongodb://nebula:nebula@127.0.0.1:27017/nebula?authSource=admin
  - DOCKER_HUB_ORG=nebulaorchestrator
  - DOCKER_HUB_REPO=reporter
  - GITHUB_PROJECT=reporter
  - secure: teZI28CubTlE1OpTB7wkPzk8GjIiwJp3ksMzddrbV59xMcQlzok5zIJvhw0LWf5L4EHSlJht8BtD0/8PbCafBENACT/x5bTl5Ru3aHsZftmbOJW6C8pALdE/N09Xw/NH/6yVaDS/FdtI6W1/ldTtAP2PNiEpLQm9tvg3n5ye0MHMtPRxwEQ2iWjbiWOZVxgfDpP6/A5UPe5cmlUimcELM/ctGym/LDSNO/XJnwapWpSGvjFMuTqU1JH9OTvyD3Bvhy1rSPhvFomyD2Yk77dhuKloU0O1l5KxvF1RzGffGMu8xTZWHMRiuE8/Myl/hBH+PCmAgHwRGSieqfr+9LgwvfIw22UBYn3ySpZ596SulMst+/rwLZ1inxwxg75jHE2xWJWmGyM3TT1TJ9hD1CAkPFs+5UIO1kF6gYk7TG85mtA7avGsflAivQu8qDjqVmJEl7lvHSKM1wauj3790aLXUtP1odjvd/CcCUaJ6+NrpwuItg07KEfnb0CJzyfFMmuGwP441x1qo8I7woaEitLR0fLhODomAyUb4MkmNo0Ntq9shlaJNmcXZdJ7KHwd82t48qTGspi2s6K/ZwzyAl6Kio0izd9NQIb9wiHlWHL83xhetbSNR4wkyz24qWI35mwoI0X/aXrCwwUl1xj0chgqVz5BY/2puoyGuIj5qKN1CL4=
  - secure: uwECiToau8OXCUbmd/ZMyeIDqHGMAq/WE+SBHZ/yqAhEQJ5b5G5B/8tuZPdP9GQeWVj+7469gS9zEhLrXR3ux9fIkJRWDW7alLBkxnul5pisv95GeTa2oxKtDeB+Xikeb0ZXI06BT8n9GBVKAYokhE+GL55xxvZ2xjICjR+Z+YR7N/RhBU4xLnW6qUyVpS7oW1WuHMrYwWsTkX2ktYhnhrJjOWDM+4nEHlH5XM0fDGn5PXxTiPM/8bhQFo/8/gPnK4gQCFdV4dD9OdL3TlCodpPv77jcUdNWIlXilt2eAPbjJKZvC26JpA5TQP9RcaYDYCStGtbi49uiZ7Ay6mL9q/u0G6Yf75vUTHL/jGiZH7FPBu6bvpM1jVoBKRJr3BK1aYu/pJPAIPcsSPDb5rSno1f0T7TrPl4EFzI6NxwT73hQG3K9Pu33mn9KXA4Ags2YoR7Ov194z7b95N0RIDo0k+qKHjpWSTnxR+BiMDAWH2bXSh8QpKRts65hOC+WY2X1lhi4YD3euESKQxm4Ima/otcLmaXCwEvsvwHs4+qNCAvly4tInrJUer9j/65yAMQ38iBxwpf6oovXdd0qhVi3HtXgNouox97lc+C0VJEhqw2nGJd3vflsQcFU7w44WOd7aTNFTk9y0V91vO9phPfp/IQQ1zpqoq1dxLr1plAYC8k=
  - secure: EnNTXzrPX4ShJ59XmPmSHNsWsRdXqnjz00hDqBenBNr63C6xUNKoH+2slF99NXTZUqLDThJ9QiQuN7m9p3bg2kzppUXOe83UG+/ozxXA2OmBM5hkBMQwO+NPwHbBa2/1Jn+1zFxQXDKfwlJKx6CwNpqgKubx3PgPRswzTXv48caNEgne47/1HPmXJqSqAHQJMliv0HcNHRBiiH9QRqjGldNWXtFRYiU9WbykvFJpzMzhrFbxGejCnCFtB40zYxaDgSxoGygQrXyyfZ8QqMk2NYn9vC2ACWRPG1+4W/UwiMT9cLF6YDjS76dN/ut0SzlwroXNbACDoqV2rB0jJiJ/Vb+EBXYV8qgEir2MJBsYcc9hK+NGuhHQRCYXlfd4XwetxSF487nATPifXk0zbgUHQAGSsC5xZFk3PrtHae9tVi1WM2ikQbwp4CckvJHeU+Ch2La95eZCo83CjQimQRAp563SjVQBUkfbOJcEGgEK16IdTIAYWXxlx05QDzfdICz46gbUKJzLqny1O3SQ281WKKhavcIjZzpDBnhRY3hiJTUfDk6pWInhQhsilbJsFG0ocsPt5aO64QDGSDbUwJxI+Z1/XrBm6qe6N9BdPzRyTaVpHYkT472PNv0rtqcyA2EIN9yGwHP28kXKReGrzl+EczvFDlwrD/TifTrMIsfijvk=
  - secure: chk0YNOxSmOk8SJCm6/CeK0/Tsi+ZlfuvLoT9dG8BA3w9UCUBhYGKjkloyFmSV5Xkpr6ISYd6LJ2uxNwrvqqg2Pfm1mZv+3A4iLsr2AC1O5hLt3Xl0u7PeIgsJkKwtUr7ZmqUbx0K+S3rZQpLSs8gxYdSamtSRcKdPp6ccIKq6qQAq6UO+Wcer61VIfe9bbcZKrqsEPmts5428XVKhzB2oyqoB1mVXiwuSe2kjc7CFL/PrOCNn2DNTIOV6QWA9D08x02SUZLcUrY0CJKdwE8c961TZjzQVONuZdfyIVREablxhoDof98YfkS8K4AVTroneKi21JcajWV1pMKKU6ehVrmWNVx1mc4CBHTMnjcXo4cCWk3maqK/T2rP8EEd3l8hvqtYSSlNfO+MLVHFKcc0rVyXX0h8OwAJ+10wBa2VGIDqMaXFWF0kdSzB/lZ/X1e0Ylawc2u39A6iznYMPKCN5aEBloDdcGQ9X9K87ZjjFUK/BQfLubIdK7qqEEH9X7p16szGvbwAG3xI8O5YwyQdj85KLnNIA0WXAJ4aO2HBou/50OczpyD7OoVj6F9niLztmd+w1DVro/m4ZlRsKZrk5+A9byUiJYeXYjdPe5nyjEmloRQgNb4QxJDmG6ZjHWfCkCyeH2PDujbVxVJVPOK27mZlD/tDA0o6g/6bqQguuw=
  - secure: cHgJaR2ifVmlUJyLwjmzCb9rJsWLLpVU5+vfNspeD5XJodwvSmI5zybZr+NQ2i9di1sPetIc28KbNEmDMSlzy22dSaqea8ZxPmc0RVMd/7x+wbOxmQqbd8kx7+RdW26qQojjV8GBOIM+hRHkLl0tv7SxxV+T6nZb3LhMHh43VoIiUlkiSgiX5KenI8opqz1K63N4+koVbNjdZHlrOY1rI+SE02WK5AnikE1F5LZtYd2FMfpVrgWQJOXqJM9Oy2DcZ+HI/aK7VIsFSwvUcBZhc94aFx3AvXwbc8Q8rFn6jKU7r18T/3euNUNNfgwqMDj36x4wKlqv1XP9/+bRcwCQeujahIHxE7d/eAkclSV8CGkZqIKxwWK8NPFiCKlHoBrcb9CGVQw3IRmUZ630RRkICz8FtWb8gVgDGFeZA0mwEZDvGTueKqUtVbrt5V+HkKIbjsl4cgpd4AbqsBURTGhlc/sNaCBefGV8fA3VRwWhTJiLoqXGyT2Y5keXZyNco06JSBYRNtKiz1wAWD6Eb0PqywalxhDwCk0ZximJ1jVvB5RCY9a7iWCfi8cKe0XdboJ2ZAL1s+s2cMbndQX0z5AigpbmbGRQlbNt5DiRc4bp62TwaSBx6YCqr0BK9kYpNPzNEUnOkoTGy0yG6huvHWNnaMKLOAQHum277fbmNAr2LT4=
install:
- pip install -r requirements.txt
- pip install codecov
script:
- sudo sh test/travis_ci_scripts/travis_ci_build_script.sh
- coverage run -m unittest
deploy:
  on:
    all_branches: true
  provider: script
  script: bash  test/travis_ci_scripts/deploy.sh
after_success:
- codecov
after_deploy:
- git config credential.helper "store --file=.git/credentials"
- echo "https://${GH_TOKEN}:@github.com" > .git/credentials
- git config --local user.name "${GITHUB_USER}"
- git config --local user.email "${GITHUB_USER_EMAIL}"
- docker run -e GITHUB_USER=nebula-orchestrator -e GITHUB_PROJECT=${GITHUB_PROJECT} -e CHANGELOG_GITHUB_TOKEN=${GH_TOKEN} -v `pwd`:/output naorlivne/github-changelog-generator-dockerized
- git add CHANGELOG.md
- git commit -m '[skip travis] build ${TRAVIS_BUILD_NUMBER} pushed - new version changelog'
- git push origin HEAD:master
